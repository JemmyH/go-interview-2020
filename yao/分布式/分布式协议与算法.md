

[toc]

# 分布式协议与算法

## gossip

Gossip协议，是一个比较简单的分布式协议，它的小名又叫留言传播。使用Gossip协议的有：Redis Cluster、Consul、Apache Cassandra等。



### 六度分隔理论

说到社交网络，就不得不提著名的**六度分隔理论**。1967年，哈佛大学的心理学教授Stanley Milgram想要描绘一个连结人与社区的人际连系网。做过一次连锁信实验，结果发现了“六度分隔”现象。简单地说：“你和任何一个陌生人之间所间隔的人不会超过六个，也就是说，最多通过六个人你就能够认识任何一个陌生人。



### 原理

Gossip协议基本思想就是：一个节点想要分享一些信息给网络中的其他的一些节点。于是，它**周期性**的**随机**选择一些节点，并把信息传递给这些节点。这些收到信息的节点接下来会做同样的事情



### 用途

Gossip协议的主要用途就是**信息传播和扩散**：即把一些发生的事件传播到全世界。它们也被用于数据库复制，信息扩散，集群成员身份确认，故障探测等。



### 失败容错

Gossip也具备失败容错的能力，即使网络故障等一些问题，Gossip协议依然能很好的运行。因为一个节点会**多次**分享某个需要传播的信息，即使不能连通某个节点，其他被感染的节点也会尝试向这个节点传播信息



### 缺陷

**拜占庭**问题（Byzantine）。即，如果有一个恶意传播消息的节点，Gossip协议的分布式系统就会出问题。



## raft [ TODO ]

raft是工程上使用较为广泛的强一致性、去中心化、高可用的分布式协议



### 原理

raft协议中，一个节点任一时刻处于以下三个状态之一：

- leader
- follower
- candidate



### 脑裂

假设一个 5 节点的 Raft 集群，其中三个节点在 A 机房，Leader 节点也在 A 机房，两个节点在 B 机房。突然 A、B 两个机房之间因其他故障无法通讯，那么此时 B 机房中的 2 个Follower 因为失去与 Leader 的联系，均转变自身角色为 Condidate。根据 Leader 选举机制，B 机房中产生了一个新的 Leader，这就发生了脑裂即存在 A 机房中的老 Leader 的集群与B机房新 Leader 的集群

解决：

当网络恢复，因为A有2个Follower而B只有1个Follower，所以B的Leader会变成Follower。a会把日志同步到所有Follower

脑裂







## raft与gossip

raft实现了强一致性

gossip实现了最终一致

